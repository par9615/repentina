


/* VALORES EN HEXA PARA MOSTRAR LOS NUMEROS EN EL DISPLAY */

CERO   EQU 040H
UNO    EQU 079H
DOS    EQU 024H
TRES   EQU 030H
CUATRO EQU 019H
CINCO  EQU 012H
SEIS   EQU 003H
SIETE  EQU 078H
OCHO   EQU 000H
NUEVE  EQU 018H

/* DIRECCIONES PARA LOS CALCULOS INTERNOS DE LAS HORAS */

HORC1 EQU 030H
HORC0 EQU 031H
MINC1 EQU 032H
MINC0 EQU 033H
SEGC1 EQU 034H
SEGC0 EQU 035H
HORCAUX EQU 036H

/* DIRECCIONES DEL DISPLAY DE ACTUALIZACIONES */
HORA1 EQU 038H
HORA0 EQU 039H
MINA1 EQU 03AH
MINA0 EQU 03BH
SEGA1 EQU 03CH
SEGA0 EQU 03DH

/* DIRECIONES DEL DISPLAY REAL */
HORR1 EQU 03EH
HORR0 EQU 03FH
MINR1 EQU 040H
MINR0 EQU 041H
SEGR1 EQU 042H
SEGR0 EQU 043H

/* SELECTOR DEL DISPLAY */
DISP_SEL EQU 037H

/*DIRECCIONES TIMER 2*/
T2CON EQU 00C8H
RCAP2L EQU 00CAH
RCAP2H EQU 00CBH
TL2 EQU 00CCH
TH2 EQU 00CDH
TF2 EQU 00CFH
	
/*DIRECCIONES DE CONTADORES DE S,M,H */


/* AUXILIAR DEL ACUMULADOR PARA NO PERDER SU VALOR DURANTE UNA SUBRUTINA */
AAUX EQU 044H

/* ================= VECTORES DE INTERRUPCION ========================= */
ORG 0000H
	SJMP INICIALIZAR
 
/*ORG 0003H
	JMP IEXT0*/
	
ORG 000BH
	JMP ITIM0

/*ORG 0013H
	JMP IEXT1

ORG 001BH
	JMP ITIM1*/

ORG 002BH
	JMP ITIM2
/* ================= VALORES INICIALES ========================= */

/* VALORES INICIALES DE LA HORA PARA CALCULOS (12:00:00) */

INICIALIZAR: 
MOV HORC1, #01H
MOV HORC0, #02H
MOV MINC1, #00H
MOV MINC0, #00H
MOV SEGC1, #00H
MOV SEGC0, #00H

/* VALORES INICIALES DE LA HORA PARA EL DISPLAY DE ACTUALIZACIONES */
MOV HORA1, #UNO
MOV HORA0, #DOS
MOV MINA1, #CERO
MOV MINA0, #CERO
MOV SEGA1, #CERO
MOV SEGA0, #CERO

/* VALORES INICIALES DE LA HORA PARA EL DISPLAY REAL */
MOV HORR1, #CERO
MOV HORR0, #CERO
MOV MINR1, #CERO
MOV MINR0, #CERO
MOV SEGR1, #CERO
MOV SEGR0, #CERO

/* VALORES INICIALES DE LOS REGISTROS */
MOV R2, #00H
MOV R3, #00H
MOV R4, #00H
MOV R5, #00H
MOV R6, #00H
MOV R7, #00H

/* VALORES INICIALES DEL AUXILIAR Y EL SELECTOR DEL DISPLAY */
MOV DISP_SEL, #00H
MOV AAUX, #00H

/* ================= TIMER 2 ========================= */


/*INICIALIZAR TIMER 2*/
MOV RCAP2H, #HIGH(-50000); CUENTE 500MS PARTE ALTA
MOV RCAP2L, #LOW(-50000)
MOV TH2, #HIGH(-50000)
MOV TL2, #LOW(-50000)
MOV T2CON, #00000100B



/* ================= TIMER 0 Y 1 ========================= */
/* INICIALIZAR TIMER 0 Y 1
- T0 EN AUTO DE 8, T1 EN AUTO DE 8
- VALORES DE CONTROL
- INTERRUPCIONES
- FALTA IP
*/
MOV TMOD, #23H 
MOV TCON, #00h ; NADA HABILITADO
MOV IE, #10101111B
MOV IP, #00101000B ; PRIORIDAD T2 Y T1

/* VALORES INICIALES PARA TIMER 0 Y 1 CON AUTORECARGA */
/*MOV TH1, #-200
MOV TL1, #-200
SETB TR1 ;INICIA TIMER 1
MOV DPTR, #1000H*/

MOV TH0, #HIGH(-50000)
MOV TL0, #LOW(-50000)
SETB TR0
/* ================================================ */
/* =                                              = */
/* =                    MAIN                      = */
/* =                                              = */
/* ================================================ */

/* ================= INTERRUPCIONES ========================= */

MAIN:
SJMP $
	
	
ITIM2:
	;CPL P0.0
	CLR TF2
	
	
	
	RETI
	
/*ITIM1:
	RETI*/

ITIM0:
	ACALL REFRESH
	CLR TF0
	RETI

/* ================= SUBRUTINAS ========================= */

/* SUBRUTINA PARA EL REFRESH DEL DISPLAY (CADA 4) */
REFRESH: MOV AAUX, A
		 MOV A, DISP_SEL
		 
		 CASE0: CJNE A,#00H, CASE1
				MOV P0,#11111110B
				JMP FIN
				
		 CASE1: CJNE A,#01H, CASE2
				MOV P0,#11111101B
				JMP FIN
				
		 CASE2: CJNE A,#02H, CASE3
				MOV P0,#11111011B
				JMP FIN
				
		 CASE3: CJNE A,#03H, CASE4
				MOV P0,#11110111B
				JMP FIN
				
		 CASE4: CJNE A,#04H, CASE5
				MOV P0,#11101111B
				JMP FIN
				
		 CASE5:	MOV DISP_SEL, #00H
				MOV P0,#11011111B
				JMP RSTREFRESH
				
		
		FIN: INC DISP_SEL
		RSTREFRESH: RET
		
				
		

END